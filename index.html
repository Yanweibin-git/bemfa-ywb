<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>å·´æ³•äº‘ MQTT æ¸©æ¹¿åº¦ Â· è¿œç¨‹å¼€ç¯</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;text-align:center;background:#f4f6f9;margin-top:12vh}
    h1{color:#333}
    .card{background:#fff;border-radius:10px;padding:30px 40px;display:inline-block;box-shadow:0 4px 20px rgba(0,0,0,.08)}
    .row{margin:18px 0;font-size:22px}
    .val{font-weight:700;color:#007bff;margin-left:6px}
    button{width:110px;height:42px;margin:8px;font-size:18px;border:none;border-radius:6px;cursor:pointer;color:#fff}
    .on{background:#28a745}
    .off{background:#dc3545}
    #foot{margin-top:18px;font-size:14px;color:#888}
  </style>
</head>
<body>
  <h1>ğŸŒ¡ï¸ æ¸©æ¹¿åº¦ç›‘æ§ Â· è¿œç¨‹å¼€ç¯</h1>

  <div class="card">
    <div class="row">æ¸©åº¦ï¼š<span id="T" class="val">--</span> â„ƒ</div>
    <div class="row">æ¹¿åº¦ï¼š<span id="H" class="val">--</span> %</div>
    <div class="row">ç¯çŠ¶æ€ï¼š<span id="LED" class="val">æœªçŸ¥</span></div>

    <button class="on" onclick="sendLed('on')">å¼€ç¯</button>
    <button class="off" onclick="sendLed('off')">å…³ç¯</button>
  </div>

  <div id="foot">è¿æ¥ä¸­â€¦</div>

<script>
/* ============ å”¯ä¸€éœ€è¦æ”¹çš„åœ°æ–¹ ============ */
const UID = '687ff7251f52445299eb3aebca3e34de';   // â†â†â† æ”¹æˆä½ çš„å·´æ³•äº‘ç§é’¥
/* ======================================== */

const topics = { T004:'T', H004:'H', led002:'LED' };
const ws = new WebSocket('wss://bemfa.com:9443/ws');

function sub(t){
  ws.send(JSON.stringify({uid:UID, topic:t, type:'sub'}));
}
function pub(t,msg){
  ws.send(JSON.stringify({uid:UID, topic:t, type:'pub', msg:msg}));
}

ws.onopen = () => {
  document.getElementById('foot').innerText = 'å·²è¿æ¥';
  sub('T004'); sub('H004'); sub('led002');   // è®¢é˜…ä¸‰ä¸ªä¸»é¢˜
};

ws.onmessage = (e) => {
  const d = JSON.parse(e.data);
  if(d.topic==='T004')  document.getElementById('T').innerText   = d.msg;
  if(d.topic==='H004')  document.getElementById('H').innerText   = d.msg;
  if(d.topic==='led002')document.getElementById('LED').innerText = d.msg;
};

ws.onclose  = () => document.getElementById('foot').innerText = 'è¿æ¥æ–­å¼€';
ws.onerror  = () => document.getElementById('foot').innerText = 'è¿æ¥å¼‚å¸¸';

function sendLed(sw){
  pub('led002', sw);          // å‘ led002 ä¸»é¢˜æ¨é€ on/off
}
</script>
</body>
</html>